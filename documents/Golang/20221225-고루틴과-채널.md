# 20221225-고루틴(goroutine)과 채널(Channel)이란?
[고루틴(goroutine) 이란?](https://yoongrammer.tistory.com/9), [[Go] 채널(Channel) 이란?](https://yoongrammer.tistory.com/10)를 보고 작성하였습니다.

## 고루틴(goroutine)이란?
고루틴(goroutine)이란, 프로그램에 있는 다른 고루틴과 관련하여 독립적으로 동시에 실행되는 함수입니다.  
**즉, Go언어로 동시에 실행되는 모든 활동을 고루틴이라고 합니다.**  

고루틴을 만드는 비용은 스레드에 비해 매우 적기 때문에 **경량 스레드**라고 합니다.  
모든 프로그램은 적어도 하나의 `main`함수라고 고루틴을 포함하고 고루틴은 항상 백그라운드에서 작동합니다.  

메인 함수가 종료되면 모든 고루틴은 종료되며, 따라서 고루틴보다 `main`함수가 먼저 종료되는 것을 방지해야 합니다.  

### 고루틴을 어떻게 사용하는가
Go언어에서는 단일 프로그램에서 여러 고루틴을 만들 수 있습니다. 고루틴은 prefix로 `go` 키워드를 사용해 간단히 만들 수 있는데 일반 함수와 익명 함수로 만들 수 있습니다.  

```go
package main

import "fmt"

func display(str string) {
    for i := 0; i < 3; i++ {
        fmt.Println(str)
    }
}

func displayMain(str string) {
    for i := 0; i < 3; i++ {
        fmt.Println(str)
    }
}

func main() {
    go display("Welcome")

    go fun() {
        for i := 0; i < 3; i++ {
            fmt.Println("to")
        }
    }

    displayMain("HyunSang Park")
}
```

**OutPut:**
```
HyunSang Park
HyunSang Park
HyunSang Park
```
출력 결과를 보면 고루틴 결과가 제대로 출력되지 않은 것을 볼 수 있습니다.  
**이유는 고루틴보다 메인 함수가 종료되었기 때문입니다.**

`sleep`을 이용해서 해결해 보도록 하겠습니다.
```go
package main

import (
    "fmt"
    "time"
)

func display(str string) {
    for i := 0; i < 3; i++ {
        time.Sleep(50 * time.Millisecond)
        fmt.Println(str)
    }
}

func displayMain(str string) {
    for i := 0; i < 3; i++ {
        time.Sleep(70 * time.Millisecond)
        fmt.Println(str)
    }
}

func main() {
    go display("welcome")

    go fun() {
        for i := 0; i < 3; i++ {
            time.Sleep(60 * time.Millisecond)
            fmt.Println("to")
        }
    }

    displayMain("HyunSang Park")
}
```

**Output:**
```
welcome
to
HyunSang Park
welcome
to
HyunSang Park
welcome
to
HyunSang Park
```
순서대로 올바르게 출력되는 것을 확인할 수 있습니다.  
고루틴은 동시에 수행되기에 동기화가 중요합니다.  

## 채널(Channel)이란?
Go언어에서 채널(Channel)은 고루틴을 연결해주는 통로(파이프)입니다.
기본적으로 채널은 양뱡향이며, 고루틴이 아래 이미지와 같이 동일한 채널을 통해 데이터를 보내거나 받을 수 있습니다.  

![](https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdn%2FcQjdzc%2FbtqMvKcAmg4%2FMFsV4bukDQPRNHAtQ6XsSK%2Fimg.png)

### 채널 생성
채널은 `chan` 키워드를 사용하여 만들 수 있고 동일한 유형의 데이터만 전송할 수 있습니다.  
아래와 같이 `make()` 함수를 사용하여 채널을 만들 수 있습니다.  

```go
channel := make(chan Type)
```

### 채널 송수신
`<-`연산자의 방향은 데이터 수신 또는 송신 여부를 나타냅니다.  

**<데이터 송신>**  
```
channel <- data
```

**<데이터 수신>**  
```
data := <-channel
```

아래와 같이 수신될 변수가 없어도 유효합니다.  
```
<-channel
```

### 채널 닫기
`close()` 함수를 이용해서 채널을 닫을 수 있습니다. 채널을 닫게 되면, 해당 채널로는 더 이상 송신을 할 수 없지만, 채널에 데이터가 있는 한 수신은 가능합니다.  
```go
close(channel)
```

아래 구문을 사용해서 채널이 열려 있는지 닫혀 있는지 확인할 수 있습니다.  
```go
data, ok := <-channel
```
여기서 ok값이 `true`이면 채널이 열려있다는 의미이고 `false`면 닫혀 있다는 의미입니다.  

또한 `for range`문을 사용해서 채널이 닫힐 때까지 데이터를 수신할 수 있습니다.  
```go
for item := range channel {
    ...
}
```
채널이 열려 있다면 range는 채널에 값이 들어올 때까지 대기를 하게 됩니다.  
채널이 닫히면 range 루프가 종료됩니다.  

```go
package main

import "fmt"

func main() {
  // 채널 생성
  channel := make(chan string)
  
  go func() { 
    // 값 전달
    channel <- "welcome"
    channel <- "to"
    channel <- "HyunSang Park" 
    
    // 채널 닫음
    close(channel)
  } ()
  
  // 값 수신
  for msg := range channel {
    fmt.Println(msg)
  }
}
```

**Output:**
```
welcome
to
HyunSang Park
```

## 참고한 자료
- [고루틴(goroutine) 이란?](https://yoongrammer.tistory.com/9)
- [[Go] 채널(Channel) 이란?](https://yoongrammer.tistory.com/10)

---

<p style="text-align: right; color: gray;">
2022.12.25 작성하였음.
</p>
