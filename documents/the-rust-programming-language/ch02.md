# 2. 추리 게임

## 새로운 프로젝트 준비하기
```bash
$ cargo new guessing_game
$ cd guessing_game
```

```rust
fn main() {
    println!("Hello, world!");
}
```

```bash
$ cargo run 
   Compiling guessing_game v0.1.0 (/Users/park.hyunsang/dev/github/The_Rust_Programming_Language/ch02/guessing_game)
    Finished dev [unoptimized + debuginfo] target(s) in 0.52s
     Running `target/debug/guessing_game`
Hello, world!
```
- 새로운 프로젝트를 생성한다.
- 기존의 프로젝트를 생성하면서 자동적으로 `main.rs`라는 파일 생성되는데 기본적으로 작성되어 있는 코드를 빌드하고 실행한다.

## 추릿값을 처리하기
```rust
use std::io;

fn main() {
    println!("Guess the number!");

    println!("Please input your guess.");

    let mut guess = String::new();

    io::stdin().
        read_line(&mut guess).
        expect("Failed to read line");

    println!("You guessed: {guess}");
}
```

- 사용자 입력을 받고 결괏값을 표시하기 위해서는 `io` 입출력 라이브러리를 스코프로 가져와야 한다.
`io` 라이브러리는 `std`라고 불리는 표준 라이브러리에 있다.
- 기본적으로 러스트는 모든 프로그램의 스코프로 가져오는 표준 라이브러리에 정의된 아이템 집합을 가지고 있다. 이 집하을 프렐루드(prelude)라고 부른다. 이와 관련된 내용은 [표준 라이브러리 문서](https://doc.rust-lang.org/reference/names/preludes.html)를 참고하자.
- 만약 원하는 타입이 프렐루드에 없다면 `use`문을 활용하여 명시적으로 사용할 타입을 가져와야 한다.
`std::io`는 사용자의 입력을 받는 것을 포함하여 `io`와 관련된 기능들을 제공한다.
****
### 변수에 값 저장하기
- 아래와 같이 사용자의 입력값을 저장할 **변수(variable)**를 생성한다.

```rust
let mut guess = String::new();
```
- 변수를 만들기 위해서는 `let`를 사용한다. 다음 코드도 변수를 선언하는 예시이다.

```rust
let apples = 5;
```
- 위 변수(`apples`)는 변수를 만들고 5라는 값을 묶어 넣습니다. 러스트에서 변수는 기본적으로 불변(immutable)이다. 이는 변수에 어떤 값을 집어넣으면 그 값이 안 바뀐다(상수).
- 변수의 값을 가변(mutable), 즉 변경 가능하도록 하려면 변수명 앞에 `mut`를 추가하면 된다(변수).

```rust
let apples = 5; // immutable
let mut bananas = 5; // mutable
```

```bash
cargo run                                                   
   Compiling guessing_game v0.1.0 (/Users/park.hyunsang/dev/github/The_Rust_Programming_Language/ch02/guessing_game)
    Finished dev [unoptimized + debuginfo] target(s) in 0.22s
     Running `target/debug/guessing_game`
Guess the number!
Please input your guess.
6
You guessed: 6
```

- `let mut guess`가 `guess`라는 이름의 가변 변수(변수)임을 알 수 있다. 등호(`=`)는 지금 해당 변수에 어떤 값을 묶어 넣고자 함을 뜻한다.
- 동호의 오른쪽에는 `guess`에 묶일 값이 있는데, 이번 예시에서는 함수 `String::new`의 결괏값인 새로운 `String` 인스턴스가 묶일 대상이 된다.
- [`String`](https://doc.rust-lang.org/std/string/struct.String.html)은 표준 라이브러리에서 제공하는 확장 가능한(growable) UTF-8 인코딩의 문자열 타입이다.
- `::new`에 있는 `::`는 `new`가 `String` 타입의 연관 함수(associated function)임을 나타낸다. **연관 함수란 어떤 타입에 구현된 함수고, 위의 경우에는 `String` 타입에 만들어진 함수**이다. 이 `new` 함수는 비어있는 새 문자열을 생성한다. `new`는 어떤 새로운 값을 만드는 함수 이름으로 흔히 사용되는 이름이기 때문에, 여러 타입에서 `new` 함수를 찾아볼 수 있다.
  - 연관 함수(associated function)와 관련된 자료이며, [[Rust] 메서드와 연관함수](https://yongj.in/rust/rust-methods/), [[Rust/러스트] 구조체의 메소드, 연관함수](https://hyunmin1906.tistory.com/311)를 참고하면 된다.
- **요악하자면 `let mut guess = String::new();` 라인은 새로운 빈 `String` 인스턴스를 묶어놓은 가변 변수(변수)를 생성한다.**

### 사용자 입력받기

```rust
io::stdin().
    read_line(&mut guess).
```
- 프로그램 시작 지점에 `use std::io`를 통해 `io` 라이브러리를 가져오지 않았더라도, 함수 호출 시 `std::io::stdin`처럼 작성하는 것으로 이 함수를 이용할 수 있다.
- `stdin` 함수는 터미널의 표준 입력의 핸들(handle)을 나타내는 타입인 [`std::io::Stdin`](https://doc.rust-lang.org/std/io/fn.stdin.html)의 인스턴스를 돌려준다.
- 코드의 다음 부분인 `.read_line(&mut guess)`는 사용자로부터 입력받기 위해 표준 입력 핸들에서 `read_line` 메서드를 호출한다. 여기에 `&mut guess`를 `read_line`의 인수로 전달하여 사용자 입력이 어떤 문자열에 저장될 것인지 알려준다.
- `read_line`의 전체 기능을 사용자가 표준 입력 장치에 입력할 때마다 입력된 문자들을 받아서 문자열에 추가하는 것이므로 문자열을 인수로 넘겨준 것이다. 메서드가 문자열의 내용물을 바꿀 수 있기 때문에 이 문자열 인수는 가변이어야 한다.

---

- `&`는 **코드의 여러 부분에서 데이터를 여러 번 메모리로 복사하지 않고 접근하기 위한 방법을 제공하는** ***참고자(referenc)*** **임을 나타낸다.** 참조는 복잡한 기능이고, 러스트의 큰 이점 중 하나가 바로 참조자를 사용할 때의 안정성과 편의성이다.
- 이 프로그램을 작성하기 위해 참조에 대한 자세한 내용을 알 필요는 없다. 지금 당장 참조자가 변수처럼 기본적으로 불변(상수)임을 알기만 하면 된다. 따라서 `&guess`가 아니라 `&mut guess`로 작성하여 가변(변수)으로 만들 필요가 있다.

### `Result` 타입으로 잠재적 실패 다루기
```rust
.expect("Failed to read line");
```

- 위 코드를 아래처럼 사용할 수도 있다.

```rust
io::stdin().read_line(&mut guess).expect("Failed to read line");
```
- 하나의 긴 라인은 가독성이 떨어지므로 라인을 나누는 것이 좋다. `.method_name()` 문법으로 어떤 메서드를 호출할 때는 줄 바꿈과 다른 공백문자로 긴 라인을 쪼개는 것이 보통 현명한 선택이다.
- 이전에 언급한 것처럼 `read_line`은 우리가 인수로 넘긴 문자열에 사용자가 입력한 것을 저장할 뿐만 아니라 하나의 `Result` 값을 돌려준다. 
- [`Result`](https://doc.rust-lang.org/std/result/enum.Result.html)는 *enum*이라고도 일컫는 [*열거형(enumeration)*](https://rinthel.github.io/rust-lang-book-ko/ch06-00-enums.html)인데, 여러 개의 가능한 상태 중에 하나의 값이 될 수 있는 타입이다. 이러한 기능한 상태 값을 *배리언트(vaiant)*라고 부른다.

---

- **`Result` 타입의 목적은 에러 처리용 정보를 담아내기 위한 것이다.**  
`Result`의 배리언트는 `Ok`와 `Err`입니다. 
  - `Ok`는 처리가 성공했음을 나타내며 내부에 성공적으로 생성된 결과를 가지고 있다.
  - `Err`는 처리가 실패했음을 나타내고 그 이유에 대한 정보를 가지고 있다.
- 다른 타입들처럼 `Result` 타입의 값에도 메서드가 있습니다. `Result` 인스턴스에는 [`expect` 메서드](https://doc.rust-lang.org/std/result/enum.Result.html#method.expect)가 있습니다. 만약 `Result` 인스턴스가 `Err`일 경우 `expect` 메서드는 프로그램의 작동을 멈추고 `expect`에 인수로 넘겼던 메서지를 출력하도록 한다.
- 만약 `read_line` 메서드가 `Err`를 돌려줬다면 그 에러는 운영체제로부터 발생한 에러일 경우가 많다. 만약 `Result`가 `Ok` 값이라면 `expect`는 `Ok`가 가지고 있는 결괏값을 돌려주어 사용할 수 있도록 한다. 위의 경우 결괏값은 사용자가 표준 입력으로 입력했던 바이트의 개수이다.

---

- **`expect`를 호출하지 않는다면 컴파일은 되지만 경고가 발생한다.**
```rust
io::stdin().
    read_line(&mut guess);
```

```bash
$ cargo build
   Compiling guessing_game v0.1.0 (/Users/park.hyunsang/dev/github/The_Rust_Programming_Language/ch02/guessing_game)
warning: unused `Result` that must be used
  --> src/main.rs:10:5
   |
10 | /     io::stdin().
11 | |         read_line(&mut guess);
   | |_____________________________^
   |
   = note: this `Result` may be an `Err` variant, which should be handled
   = note: `#[warn(unused_must_use)]` on by default
help: use `let _ = ...` to ignore the resulting value
   |
10 |     let _ = io::stdin().
   |     +++++++

warning: `guessing_game` (bin "guessing_game") generated 1 warning
    Finished dev [unoptimized + debuginfo] target(s) in 0.65s
```

- **러스트는 `read_line`가 돌려주는 `Result` 값을 사용하지 않았음을 경고하며 일어날 수 있는 에러를 처리하지 않았음을 알려준다.**
  - 이 경고를 없애는 옳바른 방법은 에러 처리용 코드를 작성하는 것이지만, 지금의 경우에는 문제가 발생했을 때 프로그램이 종료되는 것을 원하므로 `expect`를 사용할 수 있다.

### `println!` 자리표시자를 이용한 값 출력하기